<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Registration - RideConnect</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            color: #667eea;
            margin-bottom: 1rem;
        }
        .test-section {
            margin: 2rem 0;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 0.5rem;
        }
        .test-button {
            margin: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            background: #667eea;
            color: white;
            cursor: pointer;
            font-size: 1rem;
        }
        .test-button:hover {
            background: #5568d3;
        }
        .test-button.danger {
            background: #dc3545;
        }
        .test-button.danger:hover {
            background: #c82333;
        }
        .result {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: monospace;
            font-size: 0.9rem;
        }
        .result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1><i class="fas fa-flask"></i> Registration Test Page</h1>
        <p>This page tests the registration and error handling functionality.</p>

        <div class="test-section">
            <h3>Test 1: Valid Rider Registration</h3>
            <button class="test-button" onclick="testValidRider()">
                <i class="fas fa-user"></i> Test Valid Rider
            </button>
            <div id="result1" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>Test 2: Valid Driver Registration</h3>
            <button class="test-button" onclick="testValidDriver()">
                <i class="fas fa-car"></i> Test Valid Driver
            </button>
            <div id="result2" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>Test 3: Duplicate Registration (Should Fail)</h3>
            <button class="test-button danger" onclick="testDuplicate()">
                <i class="fas fa-exclamation-triangle"></i> Test Duplicate
            </button>
            <div id="result3" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>Test 4: Invalid Phone Number</h3>
            <button class="test-button danger" onclick="testInvalidPhone()">
                <i class="fas fa-phone-slash"></i> Test Invalid Phone
            </button>
            <div id="result4" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>Test 5: Invalid Email</h3>
            <button class="test-button danger" onclick="testInvalidEmail()">
                <i class="fas fa-envelope"></i> Test Invalid Email
            </button>
            <div id="result5" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>Test 6: Short Password</h3>
            <button class="test-button danger" onclick="testShortPassword()">
                <i class="fas fa-key"></i> Test Short Password
            </button>
            <div id="result6" class="result" style="display:none;"></div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>

    <script>
        function showResult(id, message, isSuccess) {
            const resultDiv = document.getElementById(id);
            resultDiv.style.display = 'block';
            resultDiv.className = `result ${isSuccess ? 'success' : 'error'}`;
            resultDiv.textContent = message;
        }

        async function testValidRider() {
            const randomNum = Math.floor(Math.random() * 10000);
            const userData = {
                name: "Test Rider " + randomNum,
                phone_number: `+9198765${String(randomNum).padStart(5, '0')}`,
                email: `rider${randomNum}@example.com`,
                password: "password123",
                user_type: "rider"
            };

            try {
                const response = await authManager.register(userData);
                showResult('result1', `✅ SUCCESS! User registered: ${response.user.name}`, true);
            } catch (error) {
                const errorMsg = error.message || error.detail || error.toString();
                showResult('result1', `❌ ERROR: ${errorMsg}`, false);
            }
        }

        async function testValidDriver() {
            const randomNum = Math.floor(Math.random() * 10000);
            const userData = {
                name: "Test Driver " + randomNum,
                phone_number: `+9198766${String(randomNum).padStart(5, '0')}`,
                email: `driver${randomNum}@example.com`,
                password: "password123",
                user_type: "driver",
                license_number: "DL1234567890",
                vehicle_registration: "MP09AB1234",
                vehicle_make: "Maruti",
                vehicle_model: "Swift",
                vehicle_color: "White",
                insurance_expiry: "2027-12-31"
            };

            try {
                const response = await authManager.register(userData);
                showResult('result2', `✅ SUCCESS! Driver registered: ${response.user.name}`, true);
            } catch (error) {
                const errorMsg = error.message || error.detail || error.toString();
                showResult('result2', `❌ ERROR: ${errorMsg}`, false);
            }
        }

        async function testDuplicate() {
            const userData = {
                name: "Duplicate User",
                phone_number: "+919876543210",
                email: "duplicate@example.com",
                password: "password123",
                user_type: "rider"
            };

            try {
                const response = await authManager.register(userData);
                showResult('result3', `❌ UNEXPECTED: Registration should have failed but succeeded!`, false);
            } catch (error) {
                const errorMsg = error.message || error.detail || error.toString();
                showResult('result3', `✅ CORRECTLY REJECTED: ${errorMsg}`, true);
            }
        }

        async function testInvalidPhone() {
            const userData = {
                name: "Invalid Phone User",
                phone_number: "123456",
                email: "test@example.com",
                password: "password123",
                user_type: "rider"
            };

            try {
                const response = await authManager.register(userData);
                showResult('result4', `❌ UNEXPECTED: Should have rejected invalid phone!`, false);
            } catch (error) {
                const errorMsg = error.message || error.detail || error.toString();
                showResult('result4', `✅ CORRECTLY REJECTED: ${errorMsg}`, true);
            }
        }

        async function testInvalidEmail() {
            const userData = {
                name: "Invalid Email User",
                phone_number: "+919876543299",
                email: "notanemail",
                password: "password123",
                user_type: "rider"
            };

            try {
                const response = await authManager.register(userData);
                showResult('result5', `❌ UNEXPECTED: Should have rejected invalid email!`, false);
            } catch (error) {
                const errorMsg = error.message || error.detail || error.toString();
                showResult('result5', `✅ CORRECTLY REJECTED: ${errorMsg}`, true);
            }
        }

        async function testShortPassword() {
            const userData = {
                name: "Short Password User",
                phone_number: "+919876543298",
                email: "test@example.com",
                password: "123",
                user_type: "rider"
            };

            try {
                const response = await authManager.register(userData);
                showResult('result6', `❌ UNEXPECTED: Should have rejected short password!`, false);
            } catch (error) {
                const errorMsg = error.message || error.detail || error.toString();
                showResult('result6', `✅ CORRECTLY REJECTED: ${errorMsg}`, true);
            }
        }
    </script>
</body>
</html>
